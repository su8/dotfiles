<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="../../img/file/icon.ico" /> <meta name="description" content="Blogging useful linux tips"> <link rel="canonical" href="https://wifiextender.github.io/"> <meta name="author" content="Aaron"> <title>Random CPU spikes</title> <link href="../../css/template-3/bootstrap-min.css" rel="stylesheet"> </head> <body> <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header"> <a class="navbar-brand" href="../../index.html">Home</a> <a class="navbar-brand" href="../../archive.html">Archive</a> </div> </div> </nav> <div class="container"> <div class="row"> <div class="col-lg-8"> <div class="panel panel-primary"> <div class="panel-body"><h1>Random CPU spikes</h1><div class="date-left"><span class="label label-default">2015-08-01 Author: Aaron</span></div><div class="articleline2"></div><br /><br /><p>At random intervals one of my cpu cores is hogged for a few seconds.</p><p>Re-compiling Xorg, the kernel, systemd, and several other packages didn't solved the issue.</p><p>Instead staring at my screen (to watch my statusbar) I just crafted one-liner command to do the job for me. Note that the following command includes only the most important part that does all the heavy lifting. I'm sure you know how to use conditional loops.</p><pre><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> ps -eo pcpu,comm | gawk '{ if ($1 > 10.1) { print $1,$2 } }'</pre><p>The above one-liner lists all currently running processes and formats the output to include only the cpu usage and the process name, then it is piped to <a href="https://www.gnu.org/software/gawk/manual/gawk.html" target="_blank">gawk</a> where we check if the cpu usage value is bigger than the specified <strong>10.1</strong>, if it's true we output the cpu usage and the process name.</p><p>The command was executed and I didn't touched my computer afterwards in order to reduce the load and false positives. 4 hours later the one-liner command catched the sneaky bastard.</p><img src="https://wifiextender.github.io/img/file/cpu_spikes/random_spikes.png" alt="" /><br /><p>So where <strong>mandb</strong> came from ?</p><pre><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> pacman -Qo mandb</pre><p>The package that contains it is called <strong>man-db</strong>, listing it's content revealed even more information:</p><pre><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> pacman -Ql man-db</pre><p>It revealed that there was auto-starting systemd units called <strong>man-db.service</strong> and <strong>man-db.target</strong>. Now had to verify that those units are running, if so then nuke them.</p><pre><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> systemctl list-units | grep man<p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> systemctl show -p WantedBy -p RequiredBy man-db.service</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> systemctl show -p WantedBy -p RequiredBy man-db.target</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> ln -s /dev/null /etc/systemd/system/man-db.service</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> ln -s /dev/null /etc/systemd/system/man-db.target</p></pre><p>The unit files in <strong>/usr/lib/systemd/system/</strong> can be overridden by the one in <strong>/etc/systemd/system/</strong>. The symlink from <strong>/dev/null</strong> ensures that those units will never ever start again, literary.</p><p>Whenever I decide to re-index the installed <strong>man</strong> pages all I have to do is run <code>sudo mandb</code>.</p><p>It was really creepy not knowing what causes those random cpu spikes, at least the paranoid in me didn't screamed <strong>HACKED</strong> at the beginning this time.</p> </div></div></div> <div class="col-lg-4"> <div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Popular Tags</h3></div><div class="panel-body"><div id="popular_tagz"></div></div></div> <div class="list-group"><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Recent Posts</h3></div><div id="recent_poztz"></div></div></div>  </div> </div> <footer> <div class="row"> <div class="col-lg-12"> Powered by <a href="https://github.com/wifiextender/blogfy" target="_blank">Python</a>, <a href="javascript: void(0);" onclick="showOS();">OS test</a> </div> </div> </footer> </div> <script src="../../css/js/scr.js" async></script>  </body> </html>