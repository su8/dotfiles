<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="../../img/file/icon.ico" /> <meta name="description" content="Blogging useful linux tips"> <link rel="canonical" href="https://wifiextender.github.io/"> <meta name="author" content="Aaron"> <title>Set up local proxy server which will filter all the traffic</title> <link href="../../css/template-3/bootstrap-min.css" rel="stylesheet"> </head> <body> <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header"> <a class="navbar-brand" href="../../index.html">Home</a> <a class="navbar-brand" href="../../archive.html">Archive</a> </div> </div> </nav> <div class="container"> <div class="row"> <div class="col-lg-8"> <div class="panel panel-primary"> <div class="panel-body"><h1>Set up local proxy server which will filter all the traffic</h1><div class="date-left"><span class="label label-default">2013-06-25 Author: Aaron</span></div><div class="articleline2"></div><br /><br /><p>Scenario: You want proxy server to filter the traffic on some of the ip(s) that are on your network, and/or you got children at home and do not want them to access some websites.</p><img src="https://wifiextender.github.io/img/file/1misc/squid-proxy.jpg" alt="" /><p>As usual the very fist thing to do will be:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> apt-get update</pre><p>Keep in mind that different distributions are using older and newer versions of squid, recommend you to check out what version has your repository.</p><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> apt-get install squid3</pre><p>Next, type these things as is and do not attempt to change something unless I tell you, when you see the following symbol <strong>&crarr;</strong> it will mean that you have to press enter - got it right ?</p><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> sed -i -e "/TAG: visible_hostname/,/^#[ ]*visible_hostname/{/#[ ]*visible_hostname/a\\ &crarr;<p>visible_hostname ${HOSTNAME} &crarr;</p><p>;}" "/etc/squid3/squid.conf" &crarr;</p></pre><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> LAN_RANGE="192.168.10.3" &crarr;<p<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> LAN_ALIAS="my-local-network" &crarr;</p></pre><p>Edit and replace 192.168.10.3 ip with your server internal ip.</p><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> sed -i -e "0,/INSERT YOUR OWN RULE(S) HERE/{//a\\ &crarr;<p>\\  &crarr;</p><p># Allowing Local network allowed-lan-${LAN_ALIAS}.\\  &crarr;</p><p>acl allowed-lan-${LAN_ALIAS} src ${LAN_RANGE}\\  &crarr;</p><p>http_access allow allowed-lan-${LAN_ALIAS}  &crarr;</p><p>;}" '/etc/squid3/squid.conf'  &crarr;</p></pre><p>The next thing that you will have to consider is do you want to allow or deny http access (browsing websites).</p><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> sed -i -e 's/^http_access deny all/http_access allow all/' \  &crarr;<p>'/etc/squid3/squid.conf'  &crarr;</p></pre><p>Which websites do you want to blacklist/ban ? Take your time, in the meantime see the following example example where I will blacklist/ban all subdomains that are owned by .foo.com</p><pre<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> nano /etc/squid3/squid.conf  &crarr;<p<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl yuck dstdomain .foo.com  &crarr;</p><p<code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> http_access deny yuck  &crarr;</p></pre><p>If you ever want to allow some ip(s) to access internet, then edit the <i>squid.conf</i> file and add that:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.24<p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.25</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.26</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.27</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.28</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> acl allowed-lan-my-local-network src 192.168.10.29</p></pre><p>Those ip(s) are just for demonstration, replace them with yours.</p><p>Restart the squid via:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> /etc/init.d/squid3 reload</pre><p>Now open up your browser and navigate to the <strong>Connection settings</strong>, click on manual proxy and enter the server internal ip with port 3128. Alternavely purchase few network cards and place them in the squid server, configure them to route/bridge all the traffic to the computers that will be attached. Read more about squids ACL (access control list) <a href="http://wiki.squid-cache.org/SquidFaq/SquidAcl" target="_blank">here</a></p> </div></div></div> <div class="col-lg-4"> <div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Popular Tags</h3></div><div class="panel-body"><div id="popular_tagz"></div></div></div> <div class="list-group"><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Recent Posts</h3></div><div id="recent_poztz"></div></div></div>  </div> </div> <footer> <div class="row"> <div class="col-lg-12"> Powered by <a href="https://github.com/wifiextender/blogfy" target="_blank">Python</a>, <a href="javascript: void(0);" onclick="showOS();">OS test</a> </div> </div> </footer> </div> <script src="../../css/js/scr.js" async></script>  </body> </html>