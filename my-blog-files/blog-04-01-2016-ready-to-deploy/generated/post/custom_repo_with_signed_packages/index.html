<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="../../img/file/icon.ico" /> <meta name="description" content="Blogging useful linux tips"> <link rel="canonical" href="https://wifiextender.github.io/"> <meta name="author" content="Aaron"> <title>Custom repo with signed packages</title> <link href="../../css/template-3/bootstrap-min.css" rel="stylesheet"> </head> <body> <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header"> <a class="navbar-brand" href="../../index.html">Home</a> <a class="navbar-brand" href="../../archive.html">Archive</a> </div> </div> </nav> <div class="container"> <div class="row"> <div class="col-lg-8"> <div class="panel panel-primary"> <div class="panel-body"><h1>Custom repo with signed packages</h1><div class="date-left"><span class="label label-default">2015-08-08 Author: Aaron</span></div><div class="articleline2"></div><br /><br /><p>We are going to create a custom local repo with signed packages.</p><p>I compile some of the packages on my system with the features that are relevant to me.</p><p>For example I don't want vim to be compiled with support for gpm, python2, python3, ruby or lua. That's why whenever I compile this package I would like to have a custom repo to keep it there. The package signature will verify that it wasn't modified.</p><p>You must have gpg key, if not visit <a href="https://wifiextender.github.io/post/encrypted_emails2/" target="_blank">this</a> post to learn how.</p><p>Export the public key in order to import it in the archlinux keyring.</p><pre><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> gpg --export --armor --output my_pub_key.asc user@email.com</pre><p>In order to avoid <a href="https://bugs.archlinux.org/task/42798" target="_blank">this</a> bug we have to run this command:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> dirmngr < /dev/null</pre><p>Add your <strong>my_pub_key.asc</strong> to the archlinux keyring, sign it and refresh the keys. Replace <strong>12345678</strong> with your public key:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman-key --add my_pub_key.asc<p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman-key --lsign-key 12345678</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman-key --refresh-keys</p></pre><p>Create the folder where the custom repo database, packages and their signatures will reside:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> mkdir -p -m 755 /var/custompkgs</pre><p>Add the custom repo above than the others. Also make sure that <strong>pacman</strong> only accepts signed packages.</p><img src="https://wifiextender.github.io/img/file/custom_repo/pacmanconf.png" alt="" /><br /><img src="https://wifiextender.github.io/img/file/custom_repo/siglevel.png" alt="" /><br /><p>Type in your public key and packager name:</p><img src="https://wifiextender.github.io/img/file/custom_repo/makepkg.png" alt="" /><br /><p>Let's compile an image viewer.</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman -S abs<p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> abs</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> cp -r /var/abs/community/sxiv /tmp</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> cd /tmp/sxiv</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> makepkg --clean --install --force --syncdeps --rmdeps --sign</p></pre><p>Once the program is compiled you'll be asked to enter your gpg private key password, so <strong>makepkg</strong> will be able to create detachable signature.</p><p>Add the package and it's signature to your own repo:</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> cp -r *.pkg.tar.xz{,.sig} /var/custompkgs<p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> cd /var/custompkgs</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> repo-add custom.db.tar.gz sxiv-*.tar.xz</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman -Syu</p></pre><p>Re-install the package if you want to verify that your own repo is working.</p><pre><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman -Rsnc sxiv<p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> rm -rf /var/cache/pacman/pkg/sxiv-1*</p><p><code2 style="font-weight: bold; color: rgb(239,41,41);">#</code2> pacman -S sxiv</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> pacman -Ss sxiv</p><p><code2 style="font-weight: bold; color: rgb(42,159,214);">$</code2> pacman -Qi sxiv</p></pre><p>That was it.</p> </div></div></div> <div class="col-lg-4"> <div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Popular Tags</h3></div><div class="panel-body"><div id="popular_tagz"></div></div></div> <div class="list-group"><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Recent Posts</h3></div><div id="recent_poztz"></div></div></div>  </div> </div> <footer> <div class="row"> <div class="col-lg-12"> Powered by <a href="https://github.com/wifiextender/blogfy" target="_blank">Python</a>, <a href="javascript: void(0);" onclick="showOS();">OS test</a> </div> </div> </footer> </div> <script src="../../css/js/scr.js" async></script>  </body> </html>