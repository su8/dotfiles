title:  Encrypted chat with OTR
date:   2015-07-31
author: Aaron

<p>So long IRC and other plain-text chats.</p>

<p>This post will guide you with the IM installation and off-the-record protocol configuration and usage in order you, your friends and relatives to have private communication.</p>

<p>This is my first post that was inspired from someone else post, in this case it is from Glenn Greenwald and Laura Poitras <a href="https://firstlook.org/theintercept/2015/07/14/communicating-secret-watched/" traget="_blank">website</a>. The post there deserves to be decentralised and spread among every chat user.</p>

<p>Let's begin with what off-the-record also known as OTR protocol is.</p>

<p>It is cryptographic protocol that provides encryption and perfect forward secrecy which means that no previous messages will be recovered if you lose or hand over your private key since all messages are encrypted with short-lived key, in contrast the long-lived private key in GPG/PGP will decrypt all previous messages.</p>

<p>It also provides deniable authentication which means that both parties can be confident in the authenticity of the messages, and if any message during the conversation is modified both parties will notice it.</p>

<p>It also provides <a href="https://en.wikipedia.org/wiki/Malleability_%28cryptography%29" target="_blank">Malleable</a> encryption that allows 3rd party to modify the messages (after the conversation has ended) without knowing their decryption keys, but since there is no verifiable proof (digital signature) they can't link them to the sender and receiver of the messages.</p>

<p>Each session is encrypted separately, and you and your buddy have to be  online at the same time whenever you want to have a chat with him/her, in contrast the ordinary email sending and receiving doesn't require both parties to be online at the same time and if some message is encrypted it will be encrypted with long-lived key.</p>

<h1>The onion router</h1>

<p>As starting point you must have <a href="https://www.torproject.org/" target="_blank">Tor</a> installed.</p>

<h1>Account creation</h1>

<p>Now you need to create temporary disposable email address in order to create our anonymous chat account. Launch Tor and enter the keywords <strong>temporary email</strong> in the search field, open several of the suggested websites and choose the one that doesn't require from you to enable javascript.</p>

<p>Now you need to choose <a href="https://xmpp.net/directory.php" target="_blank">some</a> XMPP <a href="https://list.jabber.at/" target="_blank">server</a> to register your chat account. Don't close the tab with the disposable email address as you will have to copy it's address and paste it in some of the registration page fields of the chosen XMPP server. I chose <a href="https://datenknoten.me/registrieren/" target="_blank">this</a> one.</p>

<h1>Install Pidgin</h1>

<p>Pidgin is one of the <a href="http://wiki.xmpp.org/web/OTR#Client_support" target="_blank">many</a> instant messaging clients that supports OTR. Install it followed by the 3rd party OTR plugin, replace <strong>pacman -S</strong> with your distro package manager:</p>

<pre>$root pacman -S pidgin pidgin-otr haveged</pre>

<p><strong>haveged</strong> will speedup the private key creation, as Pidgin is not multi threaded application and it will look like it has stalled while harversting entropy for the keys creation. Start <strong>haveged</strong> before launching Pidgin.</p>

<pre>$root systemctl start haveged</pre>

<h1>Torify Pidgin</h1>

<p>We can Torify Pidgin or in other words route our internet traffic over the Tor network. If you closed Tor start it and wait few seconds before launching Pidgin. Now you have to add the newly registered account in Pidgin, replace the input information where neeeded (username, domain, password):</p>

<img src="$img/pidgin_otr/add_account1.png" alt="" /><br />
<img src="$img/pidgin_otr/add_account2.png" alt="" /><br />

<p>Make sure that <strong>Connection security</strong> is set to <strong>Require encryption</strong>.</p>

<img src="$img/pidgin_otr/add_account3.png" alt="" /><br />

<p>Make sure to select the exact same properties.</p>

<img src="$img/pidgin_otr/add_account4.png" alt="" /><br />

<h1>Configure OTR</h1>

<p>We need to enable OTR and generate keys for each XMPP account:</p>

<img src="$img/pidgin_otr/tools_plugins.png" alt="" /><br />

<p>Click the <strong>Configure Plugin</strong> button.</p>

<img src="$img/pidgin_otr/configure_otr.png" alt="" /><br />

<p>Enable <strong>Require private messaging</strong>, now click the <strong>Generate</strong> button.</p>

<img src="$img/pidgin_otr/generate_key1.png" alt="" /><br />
<img src="$img/pidgin_otr/generate_key2.png" alt="" /><br />

<h1>Add buddies</h1>

<p>Invite your buddies.</p>

<img src="$img/pidgin_otr/add_buddy1.png" alt="" /><br />
<img src="$img/pidgin_otr/add_buddy2.png" alt="" /><br />

<h1>Authenticate buddy</h1>

<p>If you attempt to start a chat with your buddy, you'll see that Pidgin started a new OTR encrypted session, but your buddy is not authenticated, it could be anyone else than your buddy.</p>

<img src="$img/pidgin_otr/auth_buddy1.png" alt="" /><br />

<p>In order to prove that this is really your buddy we have to authenticate him/her. Click on <strong>Unverified</strong> and choose <strong>Authenticate buddy</strong>.</p>

<img src="$img/pidgin_otr/auth_buddy2.png" alt="" /><br />

<p>There are 3 ways to authenticate your buddy, but it is less error-prone to select the <strong>Fingerprint verification</strong>, sadly you'll have to ask him/her in person, via email, via phone call or any other method your buddy what is his/hers fingerprint, once verified exchange <strong>I have not</strong> to <strong>I have</strong>.</p>

<img src="$img/pidgin_otr/auth_buddy3.png" alt="" /><br />

<p>That was all the steps, you can experiment by creating another XMPP account from another computer or your Android phone. If you have any questions about Pidgin, most of them will be already answered <a href="https://developer.pidgin.im/wiki/Protocol%20Specific%20Questions" target="_blank">here</a>.</p>

<h1>Android instructions</h1>

<p>Install and launch <strong>Orbot</strong>.</p>

<img src="$img/pidgin_otr/android/connect_to_orbot.png" alt="" /><br />
<img src="$img/pidgin_otr/android/orbot_log.png" alt="" /><br />

<p>Select <strong>Get apps</strong>.</p>

<img src="$img/pidgin_otr/android/get_other_apps.png" alt="" /><br />

<p>Click the <strong>ChatSecure</strong> button, install and launch the app.</p>

<img src="$img/pidgin_otr/android/select_chatsecure.png" alt="" /><br />

<p>DO NOT skip this step !</p>

<img src="$img/pidgin_otr/android/chatsecure_master_password.png" alt="" /><br />

<p>Create the XMPP account.</p>

<img src="$img/pidgin_otr/android/register_account.png" alt="" /><br />

<p>Click the <strong>Advanced Account Settings</strong> button, followed by <strong>Chat Encryption</strong> and <strong>Force/Require</strong>.</p>

<img src="$img/pidgin_otr/android/advanced_account_settings1.png" alt="" /><br />
<img src="$img/pidgin_otr/android/advanced_account_settings2.png" alt="" /><br />
<img src="$img/pidgin_otr/android/advanced_account_settings3.png" alt="" /><br />

<p>Accept buddy invitation.</p>

<img src="$img/pidgin_otr/android/accept_invitation.png" alt="" /><br />

<p>Authenticate your buddy.</p>

<img src="$img/pidgin_otr/android/auth_buddy1.png" alt="" /><br />
<img src="$img/pidgin_otr/android/auth_buddy2.png" alt="" /><br />
<img src="$img/pidgin_otr/android/auth_buddy3.png" alt="" /><br />

<p>I really like OTR, ditched my email account completly and all of my friends, relatives are using it. Even casual computer users are able to configure it properly. Chatting with unknown persons happens always from disposable accounts.</p>

<p>That was it for the Android too. Happy hacking err chatting.</p>
